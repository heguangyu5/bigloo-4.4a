<!-- 95% W3C COMPLIANT, 95% CSS FREE, RAW HTML -->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=ISO-8859-1">
<title>Bigloo</title>
 <style type="text/css">
  <!--
  pre { font-family: monospace }
  tt { font-family: monospace }
  code { font-family: monospace }
  p.flushright { text-align: right }
  p.flushleft { text-align: left }
  span.sc { font-variant: small-caps }
  span.sf { font-family: sans-serif }
  span.skribetitle { font-family: sans-serif; font-weight: bolder; font-size: x-large; }
  span.refscreen { }
  span.refprint { display: none; }
  -->
 </style>
</head>

<body class="chapter" bgcolor="#ffffff">
<table width="100%" class="skribetitle" cellspacing="0" cellpadding="0"><tbody>
<tr><td align="center" bgcolor="#8381de"><div class="skribetitle"><strong><big><big><big>7. Bigloo<br/>A practical Scheme compiler (4.4a)<br/>User manual for version 4.4a<br/>November 2020 -- Pattern Matching</big></big></big></strong></div><center>
</center>
</td></tr></tbody></table>
<table cellpadding="3" cellspacing="0" width="100%" class="skribe-margins"><tr>
<td align="left" valign="top" class="skribe-left-margin" width="20%" bgcolor="#dedeff"><div class="skribe-left-margin">
<br/><center id='center32719'
><table width="97%" border="1" cellpadding="0" cellspacing="0" style="border-collapse: collapse;" frame="box" rules="none"><tbody>
<tr bgcolor="#8381de"><th id="tc32709" align="center" colspan="1"><font color="#ffffff"><strong id='bold32707'
>main page</strong></font></th></tr>
<tr bgcolor="#ffffff"><td id="tc32716" align="center" colspan="1"><table width="100%" border="0" style="border-collapse: collapse;" frame="void" rules="none"><tbody>
<tr><td id="tc32712" align="left" valign="top" colspan="1"><strong id='bold32711'
>top:</strong></td><td id="tc32713" align="right" valign="top" colspan="1"><a href="bigloo.html#Bigloo-A-practical-Scheme-compiler-(-4.4a-)-User-manual-for-version-4.4a-November-2020" class="inbound">Bigloo<br/>A practical Scheme compiler (4.4a)<br/>User manual for version 4.4a<br/>November 2020</a></td></tr>
</tbody></table>
</td></tr>
</tbody></table>
</center>
<br/><br/><center id='center32729'
><table width="97%" border="1" cellpadding="0" cellspacing="0" style="border-collapse: collapse;" frame="box" rules="none"><tbody>
<tr bgcolor="#8381de"><th id="tc32723" align="center" colspan="1"><font color="#ffffff"><strong id='bold32721'
>Pattern Matching</strong></font></th></tr>
<tr bgcolor="#ffffff"><td id="tc32726" align="center" colspan="1"><table cellspacing="1" cellpadding="1" width="100%" class="toc">
<tbody>
 <tr><td valign="top" align="left">7.1</td><td colspan="4" width="100%"><a href="bigloo-8.html#Bigloo-pattern-matching-facilities">Bigloo pattern matching facilities</a></td></tr>
 <tr><td valign="top" align="left">7.2</td><td colspan="4" width="100%"><a href="bigloo-8.html#The-pattern-language">The pattern language</a></td></tr>
</tbody>
</table>
</td></tr>
</tbody></table>
</center>
<br/><br/><center id='center32739'
><table width="97%" border="1" cellpadding="0" cellspacing="0" style="border-collapse: collapse;" frame="box" rules="none"><tbody>
<tr bgcolor="#8381de"><th id="tc32733" align="center" colspan="1"><font color="#ffffff"><strong id='bold32731'
>Chapters</strong></font></th></tr>
<tr bgcolor="#ffffff"><td id="tc32736" align="center" colspan="1"><table cellspacing="1" cellpadding="1" width="100%" class="toc">
<tbody>
 <tr><td valign="top" align="left"></td><td colspan="4" width="100%"><a href="bigloo-1.html#Acknowledgements">Acknowledgements</a></td></tr>
 <tr><td valign="top" align="left">1</td><td colspan="4" width="100%"><a href="bigloo-2.html#Table-of-contents">Table of contents</a></td></tr>
 <tr><td valign="top" align="left">2</td><td colspan="4" width="100%"><a href="bigloo-3.html#Overview-of-Bigloo">Overview of Bigloo</a></td></tr>
 <tr><td valign="top" align="left">3</td><td colspan="4" width="100%"><a href="bigloo-4.html#Modules">Modules</a></td></tr>
 <tr><td valign="top" align="left">4</td><td colspan="4" width="100%"><a href="bigloo-5.html#Core-Language">Core Language</a></td></tr>
 <tr><td valign="top" align="left">5</td><td colspan="4" width="100%"><a href="bigloo-6.html#DSSSL-support">DSSSL support</a></td></tr>
 <tr><td valign="top" align="left">6</td><td colspan="4" width="100%"><a href="bigloo-7.html#Standard-Library">Standard Library</a></td></tr>
 <tr><td valign="top" align="left">7</td><td colspan="4" width="100%"><a href="bigloo-8.html#Pattern-Matching">Pattern Matching</a></td></tr>
 <tr><td valign="top" align="left">8</td><td colspan="4" width="100%"><a href="bigloo-9.html#Fast-search">Fast search</a></td></tr>
 <tr><td valign="top" align="left">9</td><td colspan="4" width="100%"><a href="bigloo-10.html#Structures-and-Records">Structures and Records</a></td></tr>
 <tr><td valign="top" align="left">10</td><td colspan="4" width="100%"><a href="bigloo-11.html#Object-System">Object System</a></td></tr>
 <tr><td valign="top" align="left">11</td><td colspan="4" width="100%"><a href="bigloo-12.html#Regular-parsing">Regular parsing</a></td></tr>
 <tr><td valign="top" align="left">12</td><td colspan="4" width="100%"><a href="bigloo-13.html#Lalr(1)-parsing">Lalr(1) parsing</a></td></tr>
 <tr><td valign="top" align="left">13</td><td colspan="4" width="100%"><a href="bigloo-14.html#Posix-Regular-Expressions">Posix Regular Expressions</a></td></tr>
 <tr><td valign="top" align="left">14</td><td colspan="4" width="100%"><a href="bigloo-15.html#Command-Line-Parsing">Command Line Parsing</a></td></tr>
 <tr><td valign="top" align="left">15</td><td colspan="4" width="100%"><a href="bigloo-16.html#Cryptography">Cryptography</a></td></tr>
 <tr><td valign="top" align="left">16</td><td colspan="4" width="100%"><a href="bigloo-17.html#Errors-Assertions-and-Traces">Errors, Assertions, and Traces</a></td></tr>
 <tr><td valign="top" align="left">17</td><td colspan="4" width="100%"><a href="bigloo-18.html#Threads">Threads</a></td></tr>
 <tr><td valign="top" align="left">18</td><td colspan="4" width="100%"><a href="bigloo-19.html#Database">Database</a></td></tr>
 <tr><td valign="top" align="left">19</td><td colspan="4" width="100%"><a href="bigloo-20.html#Multimedia">Multimedia</a></td></tr>
 <tr><td valign="top" align="left">20</td><td colspan="4" width="100%"><a href="bigloo-21.html#Mail">Mail</a></td></tr>
 <tr><td valign="top" align="left">21</td><td colspan="4" width="100%"><a href="bigloo-22.html#Text">Text</a></td></tr>
 <tr><td valign="top" align="left">22</td><td colspan="4" width="100%"><a href="bigloo-23.html#CSV">CSV</a></td></tr>
 <tr><td valign="top" align="left">23</td><td colspan="4" width="100%"><a href="bigloo-24.html#Eval-and-code-interpretation">Eval and code interpretation</a></td></tr>
 <tr><td valign="top" align="left">24</td><td colspan="4" width="100%"><a href="bigloo-25.html#Macro-expansion">Macro expansion</a></td></tr>
 <tr><td valign="top" align="left">25</td><td colspan="4" width="100%"><a href="bigloo-26.html#Parameters">Parameters</a></td></tr>
 <tr><td valign="top" align="left">26</td><td colspan="4" width="100%"><a href="bigloo-27.html#Explicit-typing">Explicit typing</a></td></tr>
 <tr><td valign="top" align="left">27</td><td colspan="4" width="100%"><a href="bigloo-28.html#The-C-interface">The C interface</a></td></tr>
 <tr><td valign="top" align="left">28</td><td colspan="4" width="100%"><a href="bigloo-29.html#The-Java-interface">The Java interface</a></td></tr>
 <tr><td valign="top" align="left">29</td><td colspan="4" width="100%"><a href="bigloo-30.html#Bigloo-Libraries">Bigloo Libraries</a></td></tr>
 <tr><td valign="top" align="left">30</td><td colspan="4" width="100%"><a href="bigloo-31.html#Extending-the-Runtime-System">Extending the Runtime System</a></td></tr>
 <tr><td valign="top" align="left">31</td><td colspan="4" width="100%"><a href="bigloo-32.html#SRFIs">SRFIs</a></td></tr>
 <tr><td valign="top" align="left">32</td><td colspan="4" width="100%"><a href="bigloo-33.html#Compiler-description">Compiler description</a></td></tr>
 <tr><td valign="top" align="left">33</td><td colspan="4" width="100%"><a href="bigloo-34.html#Cross-Compilation">Cross Compilation</a></td></tr>
 <tr><td valign="top" align="left">34</td><td colspan="4" width="100%"><a href="bigloo-35.html#User-Extensions">User Extensions</a></td></tr>
 <tr><td valign="top" align="left">35</td><td colspan="4" width="100%"><a href="bigloo-36.html#Bigloo-Development-Environment">Bigloo Development Environment</a></td></tr>
 <tr><td valign="top" align="left">36</td><td colspan="4" width="100%"><a href="bigloo-37.html#Global-Index">Global Index</a></td></tr>
 <tr><td valign="top" align="left">37</td><td colspan="4" width="100%"><a href="bigloo-38.html#Library-Index">Library Index</a></td></tr>
 <tr><td valign="top" align="left"></td><td colspan="4" width="100%"><a href="bigloo-39.html#Bibliography">Bibliography</a></td></tr>
</tbody>
</table>
</td></tr>
</tbody></table>
</center>
</div></td>
<td align="left" valign="top" class="skribe-body"><div class="skribe-body">
<a name="Pattern-Matching" class="mark"></a><a name="g16126" class="mark"></a>
Pattern matching is a key feature of most modern functional programming
languages since it allows clean and secure code to be
written. Internally, ``pattern-matching forms'' should be translated
(compiled) into cascades of ``elementary tests'' where code is made as
efficient as possible, avoiding redundant tests; Bigloo's ``pattern
matching compiler'' provides this. The technique used is described in
details in [QueinnecGeffroy92], and the code generated can be considered
optimal <a href="#footnote-footnote16128"><sup><small>1</small></sup></a> due to the way this ``pattern
compiler'' was obtained.<br/><br/>The ``pattern language'' allows the expression of a wide variety of patterns,
including:<br/><br/><ul class="itemize" id='itemize16140'
><li>Non-linear patterns: pattern variables can appear more than
once, allowing comparison of subparts of the datum (through <code id='code16131'
>eq?</code>)<br/><br/></li>
<li>Recursive patterns on lists: for example, checking that the
datum is a list of zero or more <code id='code16134'
>a</code>s followed by zero or more 
<code id='code16135'
>b</code>s.<br/><br/></li>
<li>Pattern matching on lists as well as on vectors and structures, 
and record types.<br/><br/></li>
</ul>
<br/><br/><!-- Bigloo pattern matching facilities -->
<a name="Bigloo-pattern-matching-facilities"></a>
<div class="section-atitle"><table width="100%"><tr><td bgcolor="#dedeff"><h3><font color="black">7.1 Bigloo pattern matching facilities</font>
</h3></td></tr></table>
</div><div class="section">
<a name="Bigloo-Pattern-Matching-Facilities" class="mark"></a>
Only two special forms are provided for this in Bigloo: <code id='code16142'
>match-case</code> 
and <code id='code16143'
>match-lambda</code>.<br/><br/><table cellspacing="0" class="frame" cellpadding="10" border="1" width="100%"><tbody>
<tr><td><a name="g16146" class="mark"></a><a name="match-case" class="mark"></a><table width="100%" style="border-collapse: collapse;" frame="void" rules="none"><tbody>
<tr><td id="tc16150" align="left" colspan="1"><strong id='bold16148'
>match-case</strong><em id='it16149'
> key clause...</em></td><td id="tc16151" align="right" colspan="1">bigloo syntax</td></tr>
</tbody></table>
The argument <code id='code16155'
><em id='it16154'
>key</em></code> may be any expression and each <code id='code16157'
><em id='it16156'
>clause</em></code> has the form<br/><br/><center id='center16165'
><table cellspacing="0" class="color" cellpadding="0" width="95%"><tbody>
<tr><td bgcolor="#ffffcc"><pre class="prog" id='prog16163'
>(<code id='code16160'
><em id='it16159'
>pattern</em></code> <code id='code16162'
><em id='it16161'
>s-expression</em></code>...)
</pre>
</td></tr>
</tbody></table></center>

<em id='emph16166'
>Semantics: </em> A <code id='code16167'
>match-case</code> expression is evaluated as
follows. <code id='code16169'
><em id='it16168'
>key</em></code> is evaluated and the result is compared with each
successive pattern. If the pattern in some <code id='code16171'
><em id='it16170'
>clause</em></code> yields a match, then
the expressions in that <code id='code16173'
><em id='it16172'
>clause</em></code> are evaluated from left to right in an
environment where the pattern variables are bound to the corresponding
subparts of the datum, and the result of the last expression in that
<code id='code16175'
><em id='it16174'
>clause</em></code> is returned as the result of the <code id='code16176'
>match-case</code> expression.
If no <code id='code16178'
><em id='it16177'
>pattern</em></code> in any <code id='code16180'
><em id='it16179'
>clause</em></code> matches the datum, then, if there is an
<code id='code16181'
>else</code> clause, its expressions are evaluated and the result of the last
is the result of the whole <code id='code16182'
>match-case</code> expression; otherwise the result
of the <code id='code16183'
>match-case</code> expression is unspecified.<br/><br/>The equality predicate used is <code id='code16185'
>eq?</code>.<br/><br/><center id='center16190'
><table cellspacing="0" class="color" cellpadding="0" width="95%"><tbody>
<tr><td bgcolor="#ffffcc"><pre class="prog" id='prog16188'
>(<strong id='bold32740'
>match-case</strong> '(a b a)
   ((?x ?x) 'foo)
   ((?x ?- ?x) 'bar))
   =&gt; bar
</pre>
</td></tr>
</tbody></table></center>
</td></tr>
</tbody></table><br/>
The following syntax is also available:<br/><br/><table cellspacing="0" class="frame" cellpadding="10" border="1" width="100%"><tbody>
<tr><td><a name="g16195" class="mark"></a><a name="match-lambda" class="mark"></a><table width="100%" style="border-collapse: collapse;" frame="void" rules="none"><tbody>
<tr><td id="tc16199" align="left" colspan="1"><strong id='bold16197'
>match-lambda</strong><em id='it16198'
> clause...</em></td><td id="tc16200" align="right" colspan="1">bigloo syntax</td></tr>
</tbody></table>

It expands into a lambda-expression expecting an argument which, once
applied to an expression, behaves exactly like a <code id='code16203'
>match-case</code>
expression.<br/><br/><center id='center16208'
><table cellspacing="0" class="color" cellpadding="0" width="95%"><tbody>
<tr><td bgcolor="#ffffcc"><pre class="prog" id='prog16206'
>((<strong id='bold32741'
>match-lambda</strong>
   ((?x ?x) 'foo)
   ((?x ?- ?x) 'bar))
 '(a b a))
   =&gt; bar
</pre>
</td></tr>
</tbody></table></center>
</td></tr>
</tbody></table><br/>
</div><br>
<!-- The pattern language -->
<a name="The-pattern-language"></a>
<div class="section-atitle"><table width="100%"><tr><td bgcolor="#dedeff"><h3><font color="black">7.2 The pattern language</font>
</h3></td></tr></table>
</div><div class="section">
<a name="The-Pattern-Language" class="mark"></a><a name="g16211" class="mark"></a>
The syntax for &lt;pattern&gt; is:<br/><br/><center id='center16241'
><table cellspacing="0" class="color" cellpadding="0" width="95%"><tbody>
<tr><td bgcolor="#ccccff"><pre class="prog" id='prog16239'
>&lt;pattern&gt; ==&gt;                <em id='emph16214'
>Matches:</em><br/><br/>  &lt;atom&gt;                    the &lt;atom&gt;.
| (<code id='code16216'
>kwote</code> &lt;atom&gt;)            any expression <code id='code16217'
>eq?</code> to <code id='code16218'
>&lt;atom&gt;</code>.
| (<code id='code16219'
>and</code> &lt;pat1&gt; ... &lt;patn&gt;)   if all of <code id='code16222'
>&lt;pat<code id='code16221'
><em id='it16220'
>i</em></code>&gt;</code> match.
| (<code id='code16223'
>or</code> &lt;pat1&gt; ... ...&lt;patn&gt;) if any of <code id='code16224'
>&lt;pat1&gt;</code> through <code id='code16225'
>&lt;patn&gt;</code> matches.
| (<code id='code16226'
>not</code> &lt;pat&gt;)               if <code id='code16227'
>&lt;pat&gt;</code> doesn't match.
| (<code id='code16228'
>?</code> &lt;predicate&gt;)           if <code id='code16229'
>&lt;predicate&gt;</code> is true.
| (&lt;pat1&gt; ... &lt;patn&gt;)       a list of n elements. Here, <code id='code16230'
>...</code> is a
                            meta-character denoting a finite repetition
                            of patterns.
| &lt;pat&gt; ...                 a (possibly empty) repetition
                            of <code id='code16231'
>&lt;pat&gt;</code> in a list.
| #(&lt;pat&gt; ... &lt;patn&gt;)       a vector of <code id='code16233'
><em id='it16232'
>n</em></code> elements.
| #{&lt;struct&gt; &lt;pat&gt; ... }    a structure.
| <code id='code16234'
>?</code>&lt;id&gt;                     anything, and binds <code id='code16235'
>id</code> as a variable.
| <code id='code16236'
>?-</code>                        anything.
| <code id='code16237'
>??-</code>                       any (possibly empty) repetition of anything
                            in a list.
| <code id='code16238'
>???-</code>                      any end of list.
</pre>
</td></tr>
</tbody></table></center>

<em id='emph16242'
>Remark: </em> <code id='code16243'
>and, or, not, check</code> and <code id='code16244'
>kwote</code> must be
quoted in order to be treated as literals. This is the only justification
for having the <code id='code16245'
>kwote</code> pattern since, by convention, any atom which is
not a keyword is quoted.<br/><br/><ul class="itemize" id='itemize16296'
><li><code id='code16247'
>?-</code> matches any s-expr

</li>
<li><code id='code16249'
>a</code> matches the atom <code id='code16250'
>'a</code>.

</li>
<li><code id='code16252'
>?a</code> matches any expression, and binds the variable <code id='code16253'
>a</code> to
this expression.<br/><br/></li>
<li><code id='code16256'
>(? integer?)</code> matches any integer

</li>
<li><code id='code16258'
>(a (a b))</code> matches the only list <code id='code16259'
>'(a (a b))</code>.

</li>
<li><code id='code16261'
>???-</code> can only appear at the end of a list, and always succeeds.
For instance, <code id='code16262'
>(a ???-)</code> is equivalent to <code id='code16263'
>(a . ?-)</code>.<br/><br/></li>
<li>when occurring in a list, <code id='code16266'
>??-</code> matches any sequence of anything:
<code id='code16267'
>(a ??- b)</code> matches any list whose <code id='code16268'
>car</code> is <code id='code16269'
>a</code> and last
<code id='code16270'
>car</code> is <code id='code16271'
>b</code>. <br/><br/></li>
<li><code id='code16274'
>(a ...)</code> matches any list of <code id='code16275'
>a</code>'s, possibly empty.

</li>
<li><code id='code16277'
>(?x ?x)</code> matches any list of length 2 whose <code id='code16278'
>car</code> is 
 <em id='emph16279'
>eq</em> to its <code id='code16280'
>cadr</code><br/><br/></li>
<li><code id='code16283'
>((and (not a) ?x) ?x)</code> matches any list of length 2 whose 
<code id='code16284'
>car</code> is not <em id='emph16285'
>eq</em> to <code id='code16286'
>'a</code> but is <em id='emph16287'
>eq</em> to its <code id='code16288'
>cadr</code><br/><br/></li>
<li><code id='code16291'
>#(?- ?- ???-)</code> matches any vector whose length is at least 2.

</li>
<li><code id='code16293'
>#{foo (?- . ?-) (? integer?)}</code> matches any structure or
record <code id='code16294'
>foo</code> whose first and second fields are respectively a pair and an
integer. You can provide only the fields you want to test. The order is not
relevant.
</li>
</ul>
<em id='emph16297'
>Remark: </em> <code id='code16298'
>??-</code> and <code id='code16299'
>...</code> patterns can not appear
inside a vector, where you should use <code id='code16300'
>???-</code>: For example, 
<code id='code16301'
>#(a ??- b)</code> or <code id='code16302'
>#(a...)</code> are invalid patterns, whereas 
<code id='code16303'
>#(a ???-)</code> is valid and matches any vector whose first element 
is the atom <code id='code16304'
>a</code>.


</div><br>
<div class="footnote"><br><br>
<hr width='20%' size='2' align='left'>
<a name="footnote-footnote16128"><sup><small>1</small></sup></a>: In the cases of pattern matching in lists and vectors,
not in structures for the moment.
<br>
<div></div></td>
</tr></table><div class="skribe-ending">
<hr> 
<p class="ending" id='paragraph32747'
><font size="-1">
This <span class="sc">Html</span> page has been produced by 
<a href="http://www-sop.inria.fr/indes/fp/Skribe" class="http">Skribe</a>.
<br/>
Last update <em id='it32745'
>Thu Nov 19 07:13:49 2020</em>.</font></p></div>
</body>
</html>